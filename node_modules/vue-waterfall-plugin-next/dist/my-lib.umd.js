(function(y,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(y=typeof globalThis!="undefined"?globalThis:y||self,s(y.MyLib={},y.Vue))})(this,function(y,s){"use strict";function U(t){return s.getCurrentScope()?(s.onScopeDispose(t),!0):!1}const z=typeof window!="undefined";function K(t,e){function n(...r){t(()=>e.apply(this,r),{fn:e,thisArg:this,args:r})}return n}function X(t,e={}){let n,r;return a=>{const i=s.unref(t),l=s.unref(e.maxWait);if(n&&clearTimeout(n),i<=0||l!==void 0&&l<=0)return r&&(clearTimeout(r),r=null),a();l&&!r&&(r=setTimeout(()=>{n&&clearTimeout(n),r=null,a()},l)),n=setTimeout(()=>{r&&clearTimeout(r),r=null,a()},i)}}function Y(t,e=200,n={}){return K(X(e,n),t)}function q(t){var e;const n=s.unref(t);return(e=n==null?void 0:n.$el)!=null?e:n}const Q=z?window:void 0,O=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},A="__vueuse_ssr_handlers__";O[A]=O[A]||{},O[A];var E=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,tt=(t,e)=>{var n={};for(var r in t)J.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&E)for(var r of E(t))e.indexOf(r)<0&&Z.call(t,r)&&(n[r]=t[r]);return n};function et(t,e,n={}){const r=n,{window:o=Q}=r,a=tt(r,["window"]);let i;const l=o&&"ResizeObserver"in o,c=()=>{i&&(i.disconnect(),i=void 0)},u=s.watch(()=>q(t),d=>{c(),l&&o&&d&&(i=new ResizeObserver(e),i.observe(d,a))},{immediate:!0,flush:"post"}),f=()=>{c(),u()};return U(f),{isSupported:l,stop:f}}var R,$;z&&(window==null?void 0:window.navigator)&&((R=window==null?void 0:window.navigator)==null?void 0:R.platform)&&/iP(ad|hone|od)/.test(($=window==null?void 0:window.navigator)==null?void 0:$.platform);const nt=({breakpoints:t,wrapperWidth:e,gutter:n,hasAroundGutter:r,initWidth:o})=>{const a=Object.keys(t).map(f=>Number(f)).sort((f,d)=>f-d);let i=e,l=!1;for(const f of a)if(e<=f){i=f,l=!0;break}if(!l)return o;let c=0;const u=t[i].rowPerView;return r?c=(e-n)/u-n:c=(e-(u-1)*n)/u,Math.floor(c)};function rt(t){const e=s.ref(0),n=s.ref(null);et(n,i=>{const l=i[0],{width:c}=l.contentRect;e.value=c});const r=s.computed(()=>nt({wrapperWidth:e.value,breakpoints:t.breakpoints,gutter:t.gutter,hasAroundGutter:t.hasAroundGutter,initWidth:t.width})),o=s.computed(()=>{const i=t.hasAroundGutter?-t.gutter:t.gutter,l=(e.value+i)/(r.value+t.gutter);return Math.floor(l)}),a=s.computed(()=>{if(t.align==="left")return 0;if(t.align==="center"){const i=t.hasAroundGutter?t.gutter:-t.gutter,l=o.value*(r.value+t.gutter)+i;return(e.value-l)/2}else{const i=t.hasAroundGutter?t.gutter:-t.gutter,l=o.value*(r.value+t.gutter)+i;return e.value-l}});return{waterfallWrapper:n,wrapperWidth:e,colWidth:r,cols:o,offsetX:a}}function L(t,e){return new RegExp(`(^|\\s)${e}(\\s|$)`).test(t.className)}function D(t,e){if(L(t,e))return;const n=t.className.split(/\s+/);n.push(e),t.className=n.join(" ")}const ot=document.createElement("div").style,I=(()=>{const t={standard:"transform",webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform"};for(const e in t){const n=t[e];if(ot[n]!==void 0)return e}return!1})();function b(t){return I===!1?!1:I==="standard"?t:I+t.charAt(0).toUpperCase()+t.substr(1)}const C=b("transform"),T=b("animation-duration"),j=b("animation-delay"),N=b("transition"),P=b("animation-fill-mode");function it(t,e,n,r,o){const a=s.ref([]),i=s.ref(0),l=d=>{const m=t.hasAroundGutter?d+1:d;return t.gutter*m+e.value*d+r.value},c=()=>{a.value=new Array(n.value).fill(t.hasAroundGutter?t.gutter:0)},u=st(t);return{wrapperHeight:i,layoutHandle:async()=>new Promise(d=>{c();const m=[];if(o&&o.value&&o.value.childNodes.forEach(h=>{h.className==="waterfall-item"&&m.push(h)}),m.length===0)return!1;for(let h=0;h<m.length;h++){const g=m[h],p=Math.min.apply(null,a.value),H=a.value.indexOf(p),Et=l(H),v=g.style;C&&(v[C]=`translate3d(${Math.floor(Et)}px,${Math.floor(p)}px, 0)`),v.width=`${e.value}px`,v.visibility="visible";const{height:Rt}=g.getBoundingClientRect();a.value[H]+=Rt+t.gutter,t.animationCancel||u(g,()=>{const $t=t.posDuration/1e3;N&&(v[N]=`transform ${$t}s`)})}i.value=Math.max.apply(null,a.value),setTimeout(()=>{d(!0)},t.posDuration)})}}function st(t){return(e,n)=>{const r=e.firstChild;if(r&&!L(r,t.animationPrefix)){const o=`${t.animationDuration/1e3}s`,a=`${t.animationDelay/1e3}s`,i=r.style;D(r,t.animationPrefix),D(r,t.animationEffect),T&&(i[T]=o),j&&(i[j]=a),P&&(i[P]="both"),n&&setTimeout(()=>{n()},t.animationDuration+t.animationDelay)}}}const at=typeof window!="undefined"&&window!==null,B=ut(),lt=Object.prototype.propertyIsEnumerable,k=Object.getOwnPropertySymbols;function ct(t,...e){return e.map(r=>r.replace(/\[(\w+)\]/g,".$1").split(".").reduce((o,a)=>o&&o[a],t))}function ut(){return at&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function w(t){return typeof t=="function"||toString.call(t)==="[object Object]"}function ft(t){return typeof t=="object"?t===null:typeof t!="function"}function dt(t){return t!=="__proto__"&&t!=="constructor"&&t!=="prototype"}function mt(t,...e){if(!w(t))throw new TypeError("expected the first argument to be an object");if(e.length===0||typeof Symbol!="function"||typeof k!="function")return t;for(const n of e){const r=k(n);for(const o of r)lt.call(n,o)&&(t[o]=n[o])}return t}function x(t,...e){let n=0;for(ft(t)&&(t=e[n++]),t||(t={});n<e.length;n++)if(w(e[n])){for(const r of Object.keys(e[n]))dt(r)&&(w(t[r])&&w(e[n][r])?x(t[r],e[n][r]):t[r]=e[n][r]);mt(t,e[n])}return t}function M(t,e){return new Promise((n,r)=>{const o=new Image;o.onload=()=>{n(o)},o.onerror=()=>{r(new Error("Image load error"))},e&&(o.crossOrigin="Anonymous"),o.src=t})}var _;(function(t){t.LOADING="loading",t.LOADED="loaded",t.ERROR="error"})(_||(_={}));const yt={rootMargin:"0px",threshold:0},V="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",ht="";class gt{constructor(e=!0,n,r=!0){this.lazyActive=!0,this.crossOrigin=!0,this.options={loading:V,error:ht,observerOptions:yt,log:!0,ratioCalculator:(o,a)=>a/o},this._images=new WeakMap,this.lazyActive=e,this.crossOrigin=r,this.config(n)}config(e={}){x(this.options,e),e.ratioCalculator&&(this.options.ratioCalculator=e.ratioCalculator)}mount(e,n,r){const{src:o,loading:a,error:i}=this._valueFormatter(n);e.setAttribute("lazy",_.LOADING),e.setAttribute("src",a||V),this.lazyActive?(B||(this._setImageSrc(e,o,r,i),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(e,o,r,i)):this._setImageSrc(e,o,r,i)}resize(e,n){const r=e.getAttribute("lazy"),o=e.getAttribute("src");r&&r===_.LOADED&&o&&M(o,this.crossOrigin).then(a=>{const{width:i,height:l}=a,c=e.width/i*l;e.height=c;const u=e.style;u.height=`${c}px`,n()})}unmount(e){const n=this._realObserver(e);n&&n.unobserve(e),this._images.delete(e)}_setImageSrc(e,n,r,o){!n||e.getAttribute("src")===n||M(n,this.crossOrigin).then(i=>{var d,m;const{width:l,height:c}=i,u=((m=(d=this.options).ratioCalculator)==null?void 0:m.call(d,l,c))||c/l,f=e.parentNode.parentNode;f.style.paddingBottom=`${u*100}%`,e.setAttribute("lazy",_.LOADED),e.removeAttribute("src"),e.src=i.src,r(!0)}).catch(()=>{const i=this._realObserver(e);i&&i.disconnect(),o&&(e.setAttribute("lazy",_.ERROR),e.setAttribute("src",o),r(!1)),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${n} `)})})}_isOpenLazy(){return B&&this.lazyActive}_initIntersectionObserver(e,n,r,o){const a=this.options.observerOptions;this._images.set(e,new IntersectionObserver(l=>{Array.prototype.forEach.call(l,c=>{if(c.isIntersecting){const u=this._realObserver(e);u&&u.unobserve(c.target),this._setImageSrc(e,n,r,o)}})},a));const i=this._realObserver(e);i&&i.observe(e)}_valueFormatter(e){let n=e,r=this.options.loading,o=this.options.error;return w(e)&&(n=e.src,r=e.loading||this.options.loading,o=e.error||this.options.error),{src:n,loading:r,error:o}}_log(e){this.options.log&&e()}_realObserver(e){return this._images.get(e)}}var Lt="",W=(t,e)=>{for(const[n,r]of e)t[n]=r;return t};const S=s.defineComponent({props:{list:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},imgSelector:{type:String,default:"src"},width:{type:Number,default:200},breakpoints:{type:Object,default:()=>({1200:{rowPerView:3},800:{rowPerView:2},500:{rowPerView:1}})},gutter:{type:Number,default:10},hasAroundGutter:{type:Boolean,default:!0},posDuration:{type:Number,default:300},animationPrefix:{type:String,default:"animate__animated"},animationEffect:{type:String,default:"fadeIn"},animationDuration:{type:Number,default:1e3},animationDelay:{type:Number,default:300},animationCancel:{type:Boolean,default:!1},backgroundColor:{type:String,default:"#fff"},lazyload:{type:Boolean,default:!0},loadProps:{type:Object,default:()=>{}},crossOrigin:{type:Boolean,default:!0},delay:{type:Number,default:300},align:{type:String,default:"center"}},setup(t,e){const n=new gt(t.lazyload,t.loadProps,t.crossOrigin);s.provide("lazy",n);const{waterfallWrapper:r,wrapperWidth:o,colWidth:a,cols:i,offsetX:l}=rt(t),{wrapperHeight:c,layoutHandle:u}=it(t,a,i,l,r),f=Y(()=>{u().then(()=>{e.emit("afterRender")})},t.delay);s.watch(()=>[o,a,t.list],()=>{o.value>0&&f()},{deep:!0});const d=s.ref(0);return s.provide("sizeChangeTime",d),s.provide("imgLoaded",f),{colWidth:a,waterfallWrapper:r,wrapperHeight:c,getRenderURL:g=>ct(g,t.imgSelector)[0],getKey:(g,p)=>g[t.rowKey]||p,renderer:f}}}),G=()=>{s.useCssVars(t=>({"304003ce":t.backgroundColor}))},F=S.setup;S.setup=F?(t,e)=>(G(),F(t,e)):G;const _t=S,bt={class:"waterfall-card"};function wt(t,e,n,r,o,a){return s.openBlock(),s.createElementBlock("div",{ref:"waterfallWrapper",class:"waterfall-list",style:s.normalizeStyle({height:`${t.wrapperHeight}px`})},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(t.list,(i,l)=>(s.openBlock(),s.createElementBlock("div",{key:t.getKey(i,l),class:"waterfall-item"},[s.createElementVNode("div",bt,[s.renderSlot(t.$slots,"default",{item:i,index:l,url:t.getRenderURL(i)},void 0,!0)])]))),128))],4)}var pt=W(_t,[["render",wt],["__scopeId","data-v-1c4c57b0"]]),Dt="";const vt=s.defineComponent({props:{url:{type:String,default:""},title:{type:String,default:""},alt:{type:String,default:""}},setup(t,e){const n=s.inject("imgLoaded"),r=s.inject("lazy"),o=s.ref(null);s.onMounted(()=>{a()}),s.onUnmounted(()=>{i()}),s.watch(()=>t.url,(c,u)=>{a()});function a(){!o.value||r.mount(o.value,t.url,c=>{n(),c?e.emit("success",t.url):e.emit("error",t.url)})}function i(){!o.value||r.unmount(o.value)}function l(){e.emit("load",t.url)}return{lazyRef:o,imageLoad:l}}}),Ot={class:"lazy__box"},At={class:"lazy__resource"},It=["title","alt"];function St(t,e,n,r,o,a){return s.openBlock(),s.createElementBlock("div",Ot,[s.createElementVNode("div",At,[s.createElementVNode("img",{ref:"lazyRef",class:"lazy__img",title:t.title,alt:t.alt,onLoad:e[0]||(e[0]=(...i)=>t.imageLoad&&t.imageLoad(...i))},null,40,It)])])}var zt=W(vt,[["render",St],["__scopeId","data-v-b53b6b10"]]);y.LazyImg=zt,y.Waterfall=pt,Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
